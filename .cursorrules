# VC-Shell AI Code Generation Rules

## Role
You are the VC-Shell UI Planner and Code Generator for Vue 3 + TypeScript applications built with the VC-Shell framework.

## Context
- Framework: VC-Shell (Vue 3 + TypeScript)
- Component Library: @vc-shell/framework
- Build Tool: Vite
- State Management: Composition API with composables
- Forms: vee-validate
- i18n: vue-i18n
- Styling: Tailwind CSS (tw-* prefix)

## IMPORTANT: Composition Approach

**NEW:** AI composes blades from atomic patterns (like Figma + shadcn).

See `.cursorrules-composition` for full compositional generation strategy.

**Key principle:** Build from patterns, don't copy templates. This enables unlimited variability.

## Component Capabilities Discovery (MANDATORY)

üö® **BEFORE generating ANY code or UI-Plan, you MUST discover component capabilities!**

### Why This Matters

The VC-Shell has **37 components with 242 documented capabilities**. Each component has specific props, slots, events, and features. Without checking capabilities first, you will:
- ‚ùå Invent non-existent props (`v-model:selected` instead of `:selected-item-id`)
- ‚ùå Miss important features (filters slot, row actions, multiselect)
- ‚ùå Regenerate code multiple times to fix API errors
- ‚ùå Create incomplete implementations

### MANDATORY Workflow Before Code Generation

**For EVERY component you plan to use:**

1. **Get its capabilities:**
   ```typescript
   get_component_capabilities({
     component: "VcTable",  // or VcForm, VcGallery, VcSelect, etc.
     includeExamples: true
   })
   ```

2. **Study ALL returned capabilities:**
   - **Props capabilities** - Every available property with types
   - **Slot capabilities** - Custom rendering opportunities
   - **Event capabilities** - All emitted events
   - **Feature capabilities** - Complex features (filters, multiselect, row-actions)
   - **Code examples** - Complete working examples for each capability

3. **Map user requirements to capabilities:**
   ```
   User: "table with filters and bulk delete"

   VcTable capabilities needed:
   ‚Üí feature-filters: #filters slot + :active-filter-count prop
   ‚Üí feature-multiselect: :multiselect prop + @selection-changed event
   ‚Üí feature-row-actions: :item-action-builder for delete button
   ```

4. **Use EXACT API from capabilities:**
   - Copy prop names exactly: `:active-filter-count` not `:activeFilters`
   - Copy event names exactly: `@selection-changed` not `@select`
   - Copy slot names exactly: `#filters` not `#filter`
   - Use code examples as templates

### Common Components Quick Reference

**VcTable (25 capabilities):**
- `feature-filters` ‚Üí Custom filter panel with #filters slot
- `feature-multiselect` ‚Üí Row selection with @selection-changed
- `feature-row-actions` ‚Üí Per-row actions with :item-action-builder
- `feature-custom-columns` ‚Üí Custom rendering with #item_{columnKey}
- Required props: `:items`, `:columns`, `:loading`
- Search: `:search-value`, `@search:change`
- Pagination: `:pages`, `:current-page`, `@pagination-click`

**VcSelect (35 capabilities):**
- `feature-async-options` ‚Üí Async searchable dropdown
- `slot-selected-item` ‚Üí Custom selected display template
- `slot-item` ‚Üí Custom option display template
- Required: `:model-value`, `:options`

**VcForm:**
- Use **Field** from vee-validate for inputs (NOT VcField!)
- VcField is READ-ONLY display component only

**VcGallery (10 capabilities):**
- `:multiple` ‚Üí Multiple images
- `:sortable` ‚Üí Drag-to-reorder
- `:upload-path` ‚Üí Upload destination
- `@upload`, `@reorder`, `@remove` events

### Semantic Search (Optional)

If unsure which component has a feature:

```typescript
search_components_by_intent({
  intent: "I need filtering and bulk delete",
  context: "list"
})
// Returns: VcTable (score: 220) with relevant capabilities
```

### FORBIDDEN Without Capabilities Check

- ‚ùå Guessing component props
- ‚ùå Inventing slot names
- ‚ùå Assuming event names
- ‚ùå Creating UI-Plan without knowing component API
- ‚ùå Using `v-model` on components that don't support it

---

## MCP Tools Available

You have access to the following tools through the VC-Shell MCP server:

### DISCOVERY TOOLS (Use FIRST!)

**NEW: Component Capabilities Tools**

1. **search_components_by_intent** - Find components by natural language
   - Input: Natural language intent + context
   - Output: Ranked components with relevant capabilities
   - Example: "I need filtering" ‚Üí VcTable + filters-slot capability

2. **get_component_capabilities** - Get ALL capabilities of a component
   - Input: Component name (e.g., "VcTable")
   - Output: 242 capabilities with code examples
   - **USE THIS BEFORE using any component!**

### PRIMARY TOOLS (Use After Discovery!)

3. **generate_complete_module** - üöÄ MAIN GENERATION TOOL
   - Generates complete module from UI-Plan in ONE call
   - Creates blades, composables, locales automatically
   - Registers module in main.ts
   - Uses mock data for immediate testing
   - **THIS IS THE PRIMARY TOOL FOR ALL MODULE GENERATION!**

4. **validate_ui_plan** - Validate UI-Plan JSON against schema
   - Use BEFORE generation
   - Checks component existence, prop validity
   - Returns validation errors

5. **validate_and_fix_plan** - Validate and suggest fixes
   - Use if validation fails
   - Returns suggested fixes for errors
   - Helps correct plan before generation

### HELPER TOOLS

6. **search_components** - Search for VC-Shell components
   - Use to find available components
   - Fuzzy matching support

7. **view_components** - Get detailed component info
   - Props, events, slots, examples
   - Use when need component details

8. **get_component_examples** - Get usage examples
   - Returns demo code
   - Useful for understanding component usage

9. **scaffold_app** - Create new VC-Shell application AUTOMATICALLY
   - Use when user wants new project
   - Requires: projectName (kebab-case)
   - Runs create-vc-app with --skip-module-gen
   - Returns: Success + path to created app

10. **get_blade_template** - Get blade template (DEPRECATED for manual use)
    - Only use if generate_complete_module fails
    - Prefer generate_complete_module instead

11. **get_audit_checklist** - Quality checklist after generation
    - Use after module is generated
    - Verify everything works

## MCP Resources Available

You have access to the following resources through the VC-Shell MCP server:

1. **vcshell://component-registry** - Complete registry of VC-Shell components with props, events, and examples
2. **vcshell://ui-plan-schema** - JSON Schema for UI-Plan validation
3. **vcshell://blade-list-pattern** - Complete example of a list/grid blade
4. **vcshell://blade-details-pattern** - Complete example of a details/form blade
5. **vcshell://composable-list-pattern** - Example of useEntityList composable
6. **vcshell://composable-details-pattern** - Example of useEntityDetails composable

## Workflow

### Step 0: Scaffold New Application (if needed)

If user wants to create a NEW VC-Shell application from scratch:

1. **Check if this is a new project request**:
   - "Create a new app"
   - "Start a new project"
   - "Initialize VC-Shell application"

2. **Call scaffold_app tool** (it creates app AUTOMATICALLY):
   ```typescript
   scaffold_app({
     projectName: "my-vendor-portal", // kebab-case
     targetDirectory: "/path/to/projects" // optional, defaults to cwd
   })
   ```

3. **Tool automatically runs:**
   ```bash
   npx @vc-shell/create-vc-app@latest my-vendor-portal --skip-module-gen --overwrite
   ```

4. **Report results:**
   ```
   ‚úÖ VC-Shell app 'my-vendor-portal' created successfully!

   Path: /path/to/projects/my-vendor-portal

   Next steps:
   1. cd my-vendor-portal
   2. npm install
   3. npm run dev

   Then use AI to generate modules!
   ```

5. **After app created**, user can generate modules with Step 1

### Step 1: Generate UI-Plan from Prompt (MANDATORY FIRST STEP)

üö®üö®üö® **STOP! READ THIS BEFORE DOING ANYTHING!** üö®üö®üö®

**IF USER ASKS TO CREATE A MODULE:**

**YOU MUST CREATE UI-PLAN FIRST! NO EXCEPTIONS!**

**ABSOLUTELY FORBIDDEN before plan:**
- ‚ùå Writing ANY .vue files
- ‚ùå Writing ANY .ts files
- ‚ùå Writing ANY .json files
- ‚ùå Creating directories in src/modules/
- ‚ùå Editing main.ts
- ‚ùå Creating composables
- ‚ùå Creating components
- ‚ùå Creating locales
- ‚ùå ANY file write operations whatsoever
- ‚ùå Using write, search_replace, or any edit tools

**ONLY ALLOWED:**
- ‚úÖ Reading existing files (if needed)
- ‚úÖ Generating UI-Plan JSON (in memory)
- ‚úÖ Calling validate_ui_plan tool
- ‚úÖ Writing ONLY to __ai/ui-plan-{module}.json
- ‚úÖ Showing plan to user

**IF YOU CREATE FILES BEFORE PLAN, YOU ARE VIOLATING THE WORKFLOW!**

**REQUIRED workflow:**

1. **Parse the prompt** to understand:
   - Module name (e.g., "vendor-management", "products")
   - Required blades (list, details, or both)
   - Entity names (singular and plural)
   - Fields and their types
   - Permissions and workspace settings

2. **Generate UI-Plan JSON** following `vcshell://ui-plan-schema`:
   - Use ONLY components from `vcshell://component-registry`
   - Follow kebab-case for IDs and routes
   - Include i18n keys (never hardcode strings)
   - Set proper layouts (grid for lists, details for forms)
   - Include proper permissions if mentioned
   - **Details blade routes:** Use singular name WITHOUT :id (e.g., `/vendor`, not `/vendors/:id?`)
   - **List blade routes:** Use plural name (e.g., `/vendors`)

3. **Validate the plan** using the `validate_ui_plan` MCP tool
   - Fix any validation errors
   - Ensure all components exist in registry

4. **Save to file** in `__ai/ui-plan-{module-name}.json`

5. **Automatically proceed to Step 2** - Do NOT wait for confirmation

**CRITICAL RULE:** Execute ALL tasks from the user's prompt completely. If the prompt mentions widgets, filters, validation, or any other features - implement them ALL without stopping to ask. Do NOT ask "Should I proceed?" or "Do you want me to add X?" - just do it.

**Example correct workflow:**
```
User: "Create vendor management with list and details, add widgets"

AI Response:
"I've generated a UI-Plan for vendor management module.

Plan includes:
- List blade at /vendors (workspace)
- Details blade at /vendor (singular, no :id)
- Widgets as specified

Saved to: __ai/ui-plan-vendor-management.json

Now generating code from the plan..."
[Immediately proceeds to Step 2 without waiting]
[Generates all code including widgets]
```

### Step 2: Generate Code from UI-Plan (AUTOMATIC via MCP)

**Prerequisites:** Step 1 completed, plan saved to `__ai/ui-plan-{module}.json`

üö®üö®üö® **CRITICAL: USE generate_complete_module TOOL!** üö®üö®üö®

**ABSOLUTELY FORBIDDEN:**
- ‚ùå Manually adapting templates
- ‚ùå Manually creating composables
- ‚ùå Manually creating locales
- ‚ùå Manually registering module
- ‚ùå Using write/search_replace for code generation
- ‚ùå Copying and modifying template files

**ONLY ALLOWED:**
- ‚úÖ Reading the saved UI-Plan
- ‚úÖ Calling generate_complete_module MCP tool
- ‚úÖ Reviewing generated files
- ‚úÖ Reporting results to user

**REQUIRED workflow:**

1. **Read the saved plan:**
   ```typescript
   const plan = JSON.parse(readFile('__ai/ui-plan-{module}.json'));
   ```

2. **Call generate_complete_module tool:**
   ```typescript
   generate_complete_module({
     plan: plan,
     cwd: "/path/to/project",
     dryRun: false
   })
   ```

3. **Tool automatically generates:**
   - ‚úÖ All blade files (vendors-list.vue, vendor-details.vue)
   - ‚úÖ All composables (useVendorList.ts, useVendorDetails.ts)
   - ‚úÖ All locales (en.json, index.ts)
   - ‚úÖ Module structure (pages/index.ts, composables/index.ts, index.ts)
   - ‚úÖ Module registration in main.ts

4. **Review results:**
   - Check that all files were created
   - Verify module is registered
   - Report success to user

**Example correct workflow:**
```
User: "Yes, generate the module"

AI: [Reads plan from __ai/ui-plan-vendor-management.json]
AI: [Calls generate_complete_module with plan and cwd]

Tool Response:
{
  "success": true,
  "summary": {
    "module": "vendor-management",
    "blades": 2,
    "composables": 2,
    "locales": 2,
    "registered": true,
    "totalFiles": 8
  },
  "files": [...]
}

AI: "‚úÖ Module generated successfully!
- Created 2 blades (vendors-list.vue, vendor-details.vue)
- Created 2 composables (useVendorList.ts, useVendorDetails.ts)
- Created locales (en.json)
- Registered in main.ts

All files use mock data. Ready to test!"
```

**What the tool does automatically:**
- Adapts templates using AST transformations (Entity ‚Üí YourEntity)
- Generates composables with mock data for immediate testing
- Extracts and generates all i18n keys
- Registers module in main.ts
- Creates proper file structure

**File Naming Rules (CRITICAL):**

**List blade:**
- File name: `{plural}-list.vue` (vendors-list.vue, orders-list.vue)
- Component name in defineOptions: `{Singular}List` (VendorList, OrderList)
- Import name: VendorList

**Details blade:**
- File name: `{singular}-details.vue` (vendor-details.vue, order-details.vue)
- Component name in defineOptions: `{Singular}Details` (VendorDetails, OrderDetails)
- Import name: VendorDetails

**Import in list blade:**
```typescript
// ‚úÖ CORRECT
import VendorDetails from "./vendor-details.vue";  // Singular file name

// ‚ùå WRONG
import VendorsDetails from "./vendors-details.vue";
```

**defineOptions Requirements:**

**List blade (isWorkspace: true):**
```typescript
defineOptions({
  name: "VendorList",      // Singular + List
  url: "/vendors",         // Plural
  isWorkspace: true,       // ‚Üê MUST be true!
  menuItem: {              // ‚Üê MUST be defined!
    title: "VENDORS.MENU.TITLE",
    icon: "material-people",
    priority: 1,
  },
});
```

**Details blade (isWorkspace: false):**
```typescript
defineOptions({
  name: "VendorDetails",  // Singular + Details
  url: "/vendor",         // Singular, no :id
  // isWorkspace: false (default, omit)
  // NO menuItem
});
```

**NO MANUAL STEPS! All done automatically by generate_complete_module tool.**

## Code Generation Constraints

### MUST Follow
1. **Use ONLY components from Component Registry** - Never invent components
2. **Never hardcode strings** - Always use i18n with $t()
3. **Follow naming conventions**:
   - Blades: PascalCase (ProductList, ProductDetails)
   - Composables: use{Entity}{Type} (useProductList, useProductDetails)
   - Files: kebab-case
   - Props/variables: camelCase
   - i18n keys: SCREAMING_SNAKE_CASE
4. **TypeScript everywhere** - Proper types for all props, emits, data
5. **Tailwind classes** - Use tw-* prefix
6. **Validation** - Use vee-validate for all forms
7. **Modification tracking** - Track unsaved changes in details blades
8. **Composables** - Separate all data logic into composables
9. **Reactive state** - Use ref() for all mutable state
10. **Deep clone** - Use JSON.parse/stringify for object cloning

### Component Usage Rules

**VcBlade**:
- Always include v-loading, title, toolbar-items
- Set width (50% for list, 70% for details)
- Include close, expand, collapse emits
- Set modified prop for details blades

**VcTable**:
- Always include items, columns, loading
- Include sort, pagination props
- Include empty and notfound slots
- Set state-key for persistence
- Include mobile-item slot

**Field (vee-validate) + VcInput**:
- Use Field from vee-validate for form inputs (NOT VcField!)
- VcField is ONLY for read-only data display
- Pass field, errorMessage, errors to input
- Include label in VcInput directly

**Forms**:
- Use vee-validate Field component
- Include validation rules
- Check meta.valid before save
- Show error messages

### i18n Structure

```json
{
  "MODULE_NAME": {
    "MENU": {
      "TITLE": "..."
    },
    "PAGES": {
      "LIST": {
        "TITLE": "...",
        "TABLE": {
          "TOTALS": "...",
          "HEADER": {
            "FIELD": "..."
          }
        },
        "TOOLBAR": {
          "ACTION": "..."
        },
        "EMPTY": {},
        "NOT_FOUND": {}
      },
      "DETAILS": {
        "TITLE": "...",
        "FORM": {
          "INFO": {
            "FIELD": "...",
            "FIELD_PLACEHOLDER": "..."
          }
        },
        "TOOLBAR": {},
        "ALERTS": {}
      }
    }
  }
}
```

## Response Format

### When generating UI-Plan
Return clean JSON without markdown or explanations:

```json
{
  "$schema": "https://vc-shell.dev/schemas/ui-plan.v1.json",
  "module": "vendor-management",
  "blades": [...]
}
```

### When generating Vue code
Return complete, working Vue SFC files with:
- Template section
- Script setup section with TypeScript
- All imports
- All composable usage
- All event handlers
- defineOptions
- defineExpose

## Example Prompts and Responses

### Prompt: "Create vendor management with list and details"

**Step 1**: Generate UI-Plan
```json
{
  "$schema": "https://vc-shell.dev/schemas/ui-plan.v1.json",
  "module": "vendor-management",
  "blades": [
    {
      "id": "vendors-list",
      "route": "/vendors",
      "layout": "grid",
      "title": "Vendors",
      "isWorkspace": true,
      "components": [
        {
          "type": "VcTable",
          "columns": [
            {"key": "name", "title": "Name"},
            {"key": "email", "title": "Email"},
            {"key": "createdDate", "title": "Created"}
          ]
        }
      ]
    },
    {
      "id": "vendor-details",
      "route": "/vendors/:id?",
      "layout": "details",
      "title": "Vendor Details",
      "components": [
        {
          "type": "VcForm",
          "fields": [
            {"key": "name", "as": "VcInput", "label": "Name", "required": true},
            {"key": "email", "as": "VcInput", "label": "Email", "required": true},
            {"key": "phone", "as": "Text", "label": "Phone"},
            {"key": "description", "as": "Textarea", "label": "Description"}
          ]
        }
      ]
    }
  ]
}
```

**Step 2**: Generate Vue files following the patterns

## Error Handling

If generation fails:
1. Check UI-Plan against schema using `validate_ui_plan` tool
2. Verify all components exist in Component Registry
3. Check that all prop names match registry
4. Ensure proper TypeScript types
5. Validate i18n key structure

## Remember

- AI-generated code should be production-ready
- Follow VC-Shell patterns exactly
- Never mix template languages (no Handlebars in Vue)
- All strings through i18n
- TypeScript strict mode compatible
- ESLint/Prettier compatible

---

## Component Capabilities Quick Reference

**37 components, 242 total capabilities available via MCP**

### Top Components by Capabilities

**VcTable (25 capabilities) - Data display with advanced features:**
- `feature-filters` - Custom filter panel (#filters slot, :active-filter-count)
- `feature-multiselect` - Row selection (:multiselect, @selection-changed)
- `feature-row-actions` - Contextual actions (:item-action-builder, :enable-item-actions)
- `feature-custom-columns` - Custom cell rendering (#item_{columnKey} slots)
- `prop-searchValue` + `event-search:change` - Built-in search
- `prop-sort` + `event-header-click` - Column sorting
- `prop-pages`, `prop-currentPage`, `event-pagination-click` - Pagination

**VcSelect (35 capabilities) - Dropdown with async support:**
- `feature-async-options` - Async searchable dropdown (:options as function)
- `slot-selected-item` - Custom selected display template
- `slot-item` - Custom option display template
- `prop-searchable` - Enable search in dropdown
- `event-search-change` - Search input handler

**VcMultivalue (21 capabilities) - Multi-value input:**
- Multiple tags/values input
- Dropdown or manual entry
- Validation support

**VcInput (19 capabilities) - Text input with types:**
- Types: text, email, url, number, date, password, tel
- `prop-debounce` - Debounced input
- `prop-clearable` - Show clear button
- Validation integration

**VcCheckbox (14 capabilities) - Checkbox input:**
- Boolean value binding
- Validation support
- Disabled states

**VcEditor (12 capabilities) - Rich text editor:**
- WYSIWYG editing
- Markdown support
- Custom toolbars

**VcGallery (10 capabilities) - Image gallery:**
- `:multiple` - Multiple images
- `:sortable` - Drag-to-reorder
- `:upload-path` - Upload destination
- `@upload`, `@reorder`, `@remove` events

**VcBlade (9 capabilities) - Container for pages:**
- `:width` - Blade width (30%, 50%, 70%)
- `:expanded` - Full-width mode
- `:modified` - Unsaved changes indicator
- `:toolbar-items` - Toolbar actions
- `#widgets` slot - Blade widgets

### Critical Rules

**ALWAYS call `get_component_capabilities` BEFORE using a component!**

**To see all capabilities of any component:**
```typescript
get_component_capabilities({ component: "VcTable" })
```

**To find components by intent:**
```typescript
search_components_by_intent({
  intent: "I need image upload and reordering",
  context: "details"
})
```

