id: "09"
name: "Module Registration"
category: "critical"
priority: 100
enabled: true
applies_to:
  - "all"

description: |
  Module registration is AUTOMATED by the system.
  DO NOT create bootstrap.ts for module registration.
  DO NOT use registerModule() or addMenuItem() in bootstrap.ts.

rationale: |
  Module registration happens automatically via ModuleRegistrar class which:
  1. Parses main.ts
  2. Adds import statement for the module
  3. Inserts .use(ModuleName, { router }) call
  4. Saves the file

  This ensures consistent registration and prevents manual errors.

forbidden:
  - pattern: "registerModule\\("
    reason: "System automatically registers modules in main.ts"
    severity: "error"

  - file: "bootstrap.ts"
    reason: "bootstrap.ts is ONLY for dashboard widgets, NOT module registration"
    severity: "error"
    exception: "Dashboard widgets registration (registerDashboardWidget)"

  - pattern: "import.*registerModule"
    reason: "Module registration is automated"
    severity: "error"

correct_pattern:
  description: "System automatically updates main.ts"
  inline: |
    ```typescript
    // ✅ AUTOMATIC: System updates main.ts
    // File: src/main.ts (updated by ModuleRegistrar)
    import {ModuleName}Module from "./modules/{module}";

    const app = createApp(RouterView)
      .use(VirtoShellFramework, { router, i18n })
      .use({ModuleName}Module, { router })  // ← Added automatically by system
      .use(router);
    ```

wrong_pattern:
  inline: |
    ```typescript
    // ❌ WRONG: Manual registration in bootstrap.ts
    // File: src/bootstrap.ts
    import { registerModule } from "@vc-shell/framework";
    import OffersModule from "./modules/offers";

    export function bootstrap(app: App) {
      registerModule(OffersModule); // ❌ DO NOT DO THIS!
    }
    ```

instructions: |
  Follow these steps:
  1. Create blade components (*.vue files in src/modules/{module}/pages/)
  2. Create composables (*.ts files in src/modules/{module}/composables/)
  3. Create module index (src/modules/{module}/index.ts with createAppModule)
  4. Create locales (src/modules/{module}/locales/*.json)
  5. Submit code via submit_generated_code tool
  6. System automatically registers module in main.ts - DO NOTHING MANUALLY!

examples:
  - "patterns/module-registration.md"

validations:
  - type: "forbidden_file"
    file: "src/modules/*/bootstrap.ts"
    message: "❌ FORBIDDEN: Do not create bootstrap.ts for module registration"

  - type: "forbidden_function"
    function: "registerModule"
    message: "❌ FORBIDDEN: registerModule() - System handles module registration automatically"

auto_fix:
  enabled: false  # Cannot auto-fix file creation
