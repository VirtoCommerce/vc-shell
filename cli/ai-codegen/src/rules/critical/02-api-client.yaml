id: "02"
name: "API Client Pattern"
category: "critical"
priority: 100
enabled: true
generation_requirement: mandatory
scope: module
when_to_generate: before_blades
applies_to:
  - "all"

description: |
  Use useApiClient with proper client class and command objects.
  When creating mock API clients, ensure they extend AuthApiBase for useApiClient compatibility.

  IMPORTANT: ONE API client per module (e.g., offers.client.ts for offers module).
  Generate mock API client with realistic data based on entity context.

correct_pattern:
  inline: |
    ```typescript
    // ✅ CORRECT: Using API client in composable
    const { getApiClient } = useApiClient(ClientClass);
    const client = await getApiClient();
    const result = await client.methodName(new CommandObject(data));

    // ✅ CORRECT: Mock API client implementation
    import { AuthApiBase } from "@vc-shell/framework";

    export class OffersClient extends AuthApiBase {
      constructor(
        private baseUrl?: string,
        private http?: { fetch(url: RequestInfo, init?: RequestInit): Promise<Response> }
      ) {
        super();
      }

      async searchOffers(query: SearchOffersQuery): Promise<SearchOffersResult> {
        // implementation
      }
    }
    ```

wrong_pattern:
  inline: |
    ```typescript
    // ❌ WRONG: Missing client class
    const apiClient = useApiClient(); // Missing client class!
    await apiClient.method({ ... }); // No command object!

    // ❌ WRONG: Not extending AuthApiBase
    export class OffersClient {
      // Missing AuthApiBase will break useApiClient typings
    }
    ```

validations:
  - type: "regex"
    pattern: "useApiClient\\(\\w+\\)"
    message: "✓ useApiClient called with client class"
  - type: "regex"
    pattern: "extends\\s+AuthApiBase"
    message: "✓ client extends AuthApiBase"

instructions: |
  When creating a mock API client:
  1. Extend AuthApiBase and keep constructor signature: constructor(_baseUrl?, _http?: { fetch: typeof fetch }) { super(); }
  2. Use useApiClient(ClientClass) instead of manual instantiation
  3. For command objects, use `new CommandClass({ ...data })`
  4. For BulkDeleteCommand, always use: `const command = new BulkDeleteCommand({ ids: [...] });`

auto_fix:
  enabled: false
