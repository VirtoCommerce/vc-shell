# VC-Shell AI Generation Rules (v1)

## Context
- Framework: Vc-shell (Vue 3.4 + TypeScript 5.8)
- UI Components: from @vc-shell/framework
- Architecture: Blade-based navigation, Module structure
- Routing: Dynamic blade routes with params

## Module Generation Workflow

### Step 0: Discover Component Capabilities (MANDATORY FIRST STEP)

ðŸš¨ **BEFORE creating UI-Plan or generating ANY code:**

**1. Identify required components** from user's request:
- List/Grid â†’ VcTable
- Form/Details â†’ VcForm + VcInput/VcSelect/VcTextarea
- Images/Gallery â†’ VcGallery  
- File uploads â†’ VcFileUpload
- etc.

**2. Get capabilities for EACH component:**

```typescript
get_component_capabilities({ 
  component: "VcTable",
  includeExamples: true 
})
```

**Returns:** Complete API documentation including:
- Props (all available properties)
- Slots (custom rendering opportunities)
- Events (emitted events)
- Features (filters, multiselect, row-actions, etc.)
- **Code examples** for each capability

**3. Study examples in capabilities:**
- Each capability includes complete working code
- Copy and adapt examples to your entity
- Use EXACT prop/event/slot names from examples

**4. Map requirements to capabilities:**

```
User: "Product list with filters and bulk delete"

Capabilities to use:
âœ… VcTable feature-filters â†’ #filters slot + :active-filter-count
âœ… VcTable feature-multiselect â†’ :multiselect + @selection-changed
âœ… VcTable feature-row-actions â†’ :item-action-builder
```

**Example Discovery Session:**

```typescript
// User wants: "Offers table with search and filters"

// Step 1: Get VcTable capabilities
get_component_capabilities({
  component: "VcTable",
  includeExamples: true
})

// Returns 25 capabilities including:
// - feature-filters (with full filters slot example)
// - prop-searchValue  
// - event-search:change
// - prop-activeFilterCount

// Step 2: Use in UI-Plan
{
  "type": "VcTable",
  "features": ["filters", "search", "sorting", "multiselect"]
}
```

**CRITICAL:** Never guess component API. Always check capabilities first!

---

## Commands

### /ui-plan
**Purpose:** Generate UI-Plan JSON from natural language prompt

**Input:** Short prompt describing desired UI (e.g., "Product catalog grid with edit form")

**Output:** Valid `ui-plan.v1.json` adhering to schema

**MANDATORY:** Before creating plan, call `get_component_capabilities` for each component!

**Rules:**
1. **FIRST:** Discover capabilities for all components
2. Return ONLY valid JSON, no explanations
3. Use ONLY components from Component Registry (VcForm, VcInput, VcTextarea, VcSelect, VcTable, VcBlade, VcButton, VcField)
4. Use ONLY props/slots/events from capabilities
5. Never invent props or components not in Registry
6. Prefer simple layouts unless explicitly requested
7. Add permissions when feature mutates data (e.g., "product:update")
8. Include accessible labels and validation rules for forms
9. If steps/wizard requested: use `steps[]` array in blade config
10. Theme: `light` | `dark` | `system` (default: system)
11. Conservative assumptions: if prompt ambiguous â†’ minimal plan

**Field Types:**
- Text, Email, Url, Number, Date, Password (for VcInput)
- Textarea (for VcTextarea)
- Select, Checkbox, Switch (for form selections)
- Gallery, FileUpload (for media)

**Example:**
User: "Vendor list with status filter and add button"

Output:
```json
{
  "$schema": "https://vc-shell.dev/schemas/ui-plan.v1.json",
  "module": "vendors",
  "blades": [
    {
      "id": "vendor-list",
      "route": "/vendors",
      "layout": "grid",
      "title": "Vendors",
      "isWorkspace": true,
      "components": [
        {
          "type": "DataTable",
          "dataSource": "vendors",
          "columns": [
            {"key": "name", "title": "Name"},
            {"key": "status", "title": "Status"}
          ],
          "actions": ["add"],
          "filters": [{"key": "status", "type": "select"}]
        }
      ],
      "permissions": ["vendor:read"],
      "theme": {"variant": "system"}
    }
  ],
  "data": {
    "sources": {
      "vendors": {"type": "api", "endpoint": "/api/vendors"}
    }
  }
}
```

### /ui-gen
**Purpose:** Generate code from UI-Plan JSON

**Steps:**
1. If UI-Plan not already created, run /ui-plan first
2. Save plan to `./__ai/plan.json` (or use existing path)
3. Run: `pnpm vcgen generate --plan ./__ai/plan.json --fix --story`
4. Show diff of changes
5. Inform user about next steps (review code, update API clients, run dev server)

**Note:** This command uses terminal to execute CLI. Generated code includes TODO comments for API integration.

### /ui-validate
**Purpose:** Validate UI-Plan JSON without generating code

**Usage:** `pnpm vcgen validate --plan ./__ai/plan.json`

Shows validation errors, warnings, and plan summary.

## Naming Conventions
- Module names: kebab-case (e.g., `vendor-onboarding`)
- Entity names: PascalCase (e.g., `VendorProfile`)
- Files: kebab-case (e.g., `vendor-profile-details.vue`)
- Composables: camelCase with `use` prefix (e.g., `useVendorDetails`)
- I18n keys: UPPER_SNAKE_CASE (e.g., `VENDORS.PAGES.LIST.TITLE`)

## Validation
- All generated plans MUST validate against `ui-plan.v1.schema.json`
- All components MUST exist in Component Registry
- All props MUST match Registry signatures
- Module names MUST be kebab-case
- Routes MUST start with `/`

## Component Capabilities Quick Reference

**37 components, 242 total capabilities via MCP tools**

### Most Used Components

**VcTable (25 capabilities):**
- `feature-filters` - Custom filter panel (#filters slot)
- `feature-multiselect` - Bulk selection (@selection-changed)
- `feature-row-actions` - Per-row actions (:item-action-builder)
- `:search-value`, `@search:change` - Built-in search
- `:sort`, `@header-click` - Column sorting

**VcSelect (35 capabilities):**
- `feature-async-options` - Async searchable
- `#selected-item`, `#item` slots - Custom templates
- `:searchable` - Enable search

**VcGallery (10 capabilities):**
- `:multiple`, `:sortable` - Multiple sortable images
- `:upload-path` - Upload destination
- `@upload`, `@reorder`, `@remove` - Events

**VcForm + Field:**
- Use Field from vee-validate (NOT VcField!)
- VcField is READ-ONLY display only

**Get all capabilities:**
```typescript
get_component_capabilities({ component: "VcTable" })
```

---

## Code Generation Workflow

**Typical flow:**
```
User: "Product catalog: grid with search, details form with gallery"
